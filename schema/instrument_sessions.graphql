schema @link(url: "https://specs.apollo.dev/federation/v2.7", import: ["@key", "@shareable"]) {
  query: Query
}

type Account {
  accountId: Int!
  username: String!
  emailAddress: String
  title: String
  givenName: String
  familyName: String
  type: AccountType!
  state: AccountState!
  proposalRoles: [ProposalAccount!]!
  instrumentSessionRoles: [InstrumentSessionRole!]!
}

enum AccountState {
  enabled
  disabled
}

enum AccountType {
  user
  staff
  functional
}

"""Date with time (isoformat)"""
scalar DateTime

type Instrument {
  name: String!
  scienceGroup: String
  description: String
  proposals: [Proposal!]!
  instrumentSessions: [InstrumentSession!]!
}

type InstrumentSession @key(fields: "instrumentSessionNumber proposal {proposalNumber}") {
  instrumentSessionId: Int!
  instrumentSessionNumber: Int!
  startTime: DateTime
  endTime: DateTime
  type: String
  state: String
  riskRating: String
  proposal: Proposal
  instrument: Instrument!
  roles: [InstrumentSessionRole!]!
}

type InstrumentSessionRole {
  instrumentSession: InstrumentSession!
  account: Account!
  role: String!
  onSite: Boolean!
}

type PageInfo @shareable {
  startCursor: String
  endCursor: String
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
}

type Proposal @key(fields: "proposalNumber") {
  proposalNumber: Int!
  proposalCategory: String
  title: String
  summary: String
  state: ProposalState!
  instrumentSessions: [InstrumentSession!]!
  instruments: [Instrument!]!
  roles: [ProposalAccount!]!
}

type ProposalAccount {
  proposal: Proposal!
  account: Account!
  role: String!
}

type ProposalConnection @shareable {
  edges: [ProposalEdge!]!
  pageInfo: PageInfo!
}

type ProposalEdge @shareable {
  cursor: String!
  node: Proposal!
}

enum ProposalState {
  Open
  Closed
  Cancelled
}

type Query {
  _entities(representations: [_Any!]!): [_Entity]!
  _service: _Service!

  """Get a proposal by its number"""
  proposal(proposalNumber: Int!): Proposal

  """Get a list of proposals"""
  proposals(proposalCategory: String = null, first: Int = null, last: Int = null, after: String = null, before: String = null): ProposalConnection!

  """Get a instrument session"""
  instrumentSession(proposalNumber: Int!, instrumentSessionNumber: Int!): InstrumentSession

  """Get a instrument session"""
  instrumentSessions(proposalNumber: Int = null, proposalCategory: String = null): [InstrumentSession!]

  """Get an instrument"""
  instrument(instrumentName: String!): Instrument

  """Get a list of instruments"""
  instruments(scienceGroup: String = null): [Instrument!]!

  """Get an account"""
  account(username: String!): Account
}

scalar _Any

union _Entity = InstrumentSession | Proposal

type _Service {
  sdl: String!
}
